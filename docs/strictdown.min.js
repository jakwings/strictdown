;(function(T){'use strict';var p=function(a,f){return a.replace(f?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/[<>"']/g,function(a){switch(a){case "<":return"&lt;";case ">":return"&gt;";case '"':return"&quot;";case "'":return"&#39;";default:return a}})},Q=function(a){return a.replace(/([.\\+*?\^\[\]$(){}])/g,"\\$1")},C=/^  *|(\\ )|  *$/gm,M=/\\([-*+_.`~^":\[\]<>(){}|@&=#\\])/g,x=/\\([ \-*+_.`~^":\[\]<>(){}|@&=#\\])/g,I=function(a){for(var f,e=1,b=arguments.length;e<b;e++){f=arguments[e];for(var g in f)Object.prototype.hasOwnProperty.call(f,
g)&&(a[g]=f[g])}return a},O=function(a){"number"!==typeof a&&(a=a.length);var f="",e=" ";for(a|=0;0<a;a>>>=1,e+=e)a&1&&(f+=e);return f},R=function(a){var f=[],e="",b,g,c,r=0;for(b=0;g=a.charAt(b);b++)"|"!==g&&"^"!==g||"\\"===c?(c=g,e+=g,r++):(e&&(f.push(e),e=""),c=g,f.push(g));e&&f.push(e);f.cellLength=r;return f},J=function(a,f){return(f.match(a)||[]).length===f.split("\n").length},P=function(a){a=a.replace(/^ *\n(?: *\n)*/,"");for(var f=/([\s\S][\s\S]*?)(\n *\n(?: *\n)*|\n *$|$)/g,e=[],b;b=f.exec(a);)e.push(b[1]),
b[2]&&e.push(b[2]);return e},m={blanklines:/^\n/,eob:/^\^ *$/,macro:/^<\[((?:\\[\s\S]|[^\\])+)*\]> *$/,macro_start:/^<\[([\s\S]*)/,macro_end:/(?:^|\n)\]> *$/,code:/^    [^\n][^\n]*(?:\n    [^\n][^\n]*)*$/,fences:/^(~~~~*)[^\n]*(\n[\s\S]+?)?\n\1~* *$/,fences_start:/^(~~~~*)([^\n]*)/,fences_end:/(?:^|\n)(~~~~*) *$/,setext:/^([\s\S]+?)\n(?:(=)=*|--*) *$/,atx:/^(##{0,5})(?!#)((?:\\[\s\S]|[^\\])+?)(?:##* *)?$/,blockquote:/^>( *)[^\n]*(?:\n>(?:\1[^\n]*|))*$/,ul:/^[+\-*] /,ol:/^\d\d*\. /,dl:/^([^: ][^\n]*(?:\n[^: ][^\n]*)*)\n(: [\s\S]*)$/,
dd:/^:(  *)[^\n]*(?:\n \1[^\n]*)*$/,dd_pedantic:/^:  *[^\n]*(?:\n    [^\n]*)*$/,link:/^:\[(?![\^*@])([^\[\]\n\\][^\[\]\n\\]*)\]:  *([^ \n][^ \n]*) *(?:\n?  *"((?:\\["\\]|[^"\\\n])*)" *)?$/,links:/^:\[(?![\^*@])[^\[\]\n\\][^\[\]\n\\]*\]: /,abbr:/^\*\[([^\[\]\n\\][^\[\]\n\\]*)\]: ([^\n][^\n]*(?:\n [^\n][^\n]*)*)$/,abbrs:/^\*\[[^\[\]\n\\][^\[\]\n\\]*\]: /,footnotex:/^\^\[([^\[\]\n\\][^\[\]\n\\]*)\]: *((?:\n    [^\n][^\n]*)+)$/,footnote:/^\^\[([^\[\]\n\\][^\[\]\n\\]*)\]: ([^\n][^\n]*(?:\n [^\n][^\n]*)*)$/,
footnotes:/^\^\[[^\[\]\n\\][^\[\]\n\\]*\]: /,image:/^@\[([^\[\]\n\\][^\[\]\n\\]*)\]:  *([^ \n][^ \n]*) *(?:\n?  *([^ "',:;\n\}][^ "',:;\n\}]*,[^ "',:;\n\}][^ "',:;\n\}]*)?(:left|:right)? *)?(?:\n?  *"((?:\\["\\]|[^"\\\n])*)" *)?$/,images:/^@\[[^\[\]\n\\][^\[\]\n\\]*\]: /,figure:/^\[((?:\\[\s\S]|[^\\\]])+?)\]@<([^ \n][^ \n]*)(?: *\n?  *([^ "',:;\n\}][^ "',:;\n\}]*,[^ "',:;\n\}][^ "',:;\n\}]*)?(:left|:right)?)?(?: *\n?  *"((?:\\["\\]|[^"\\\n])*)")?> *$/,figures:/^\[(?:\\[\s\S]|[^\\\]])+?\]@<[^ \n]/,
hr:/^(?:- *- *- *(?:- *)*|\* *\* *\* *(?:\* *)*)$/,table:/^\+(?:==*|--*)\+ *(?:\n[\^|][^\n][^\n]*[\^|] *)*\n\+--*\+ *$/,table_line:/^([\^|+])(?:(=)=*|--*)([\^|+]) *$/,paragraph:/^[^\n][^\n]*(?:\n[^\n][^\n]*)*$/,subindented:/^(  *)[^\n][^\n]*(?:\n\1[^\n][^\n]*)*$/};m.normal={code:[0,m.code],eob:[1,m.eob],fences:[2,m.fences_start],setext:[3,m.setext],atx:[4,m.atx],blockquote:[5,m.blockquote],hr:[6,m.hr],ul:[7,m.ul],ol:[8,m.ol],links:[9,m.links],images:[10,m.images],figures:[11,m.figures],footnotex:[12,
m.footnotex],footnotes:[13,m.footnotes],abbrs:[14,m.abbrs],table:[15,m.table],dl:[16,m.dl],macro:[17,m.macro_start],paragraph:[18,m.paragrap]};var F=function(a){this.options=I({},t.defaults,a||{});this.rules=m.normal;this.tokens=[];this.tokens.links={};this.tokens.images={};this.tokens.abbrs={};this.tokens.notes={};this.tokens.headings=[];a=[];for(var f in this.rules)a.push([this.rules[f][0],f]);a.sort(function(a,e){return a[0]<e[0]?-1:1});f=0;for(var e=a.length;f<e;f++)a[f]=a[f][1];this.ruleNames=
a;this.index=0;this.headingIndex=this.noteIndex=1};F.lex=function(a,f){return(new F(f)).lex(a)};F.prototype.lex=function(a){a=a.replace(/\r\n?/g,"\n");this.options.pedantic&&this.options.hardtab&&(a=a.replace(/\t/g,"    "));var f=this.options.pedantic?0:"";return this.tokenize(P(a),f,!0,!0,!1,!1)};F.prototype.tokenize=function(a,f,e,b,g,c){var r=!this.options.pedantic,p=r?f.length:4*f,h=RegExp("^"+O(p)+"","gm"),d=p?RegExp("^ {1,"+p+"}","gm"):/^$/,D=this.index,q;q=b?this.index:this.index=0;var G=a.length,
l;a:for(;q<G;q++)if(l=a[q],m.blanklines.test(l))c=!1;else{if(J(h,l)){if(l=l.replace(d,""),r&&!c&&/^  {0,2}(?! )/.test(l)){var E=m.subindented.exec(l);if(E&&4>E[1].length){this.index=q;this.tokenize(a,f+E[1],e,!0,g,!0);q=this.index-1;continue}c=!1}}else break a;for(var E=0,k;k=this.ruleNames[E];E++){var s=this.rules[k][1],n=null;b:switch(k){case "eob":if(s.test(l))continue a;break;case "macro":if(n=s.exec(l)){k=n[1]||"";if(n=m.macro.exec(l))k=n[1]||"",E=(k.match(/^[^ \n][^ \n]*/)||[""])[0],k=k.substr(E.length).replace(/^\n\n*/,
"");else for(E=(k.match(/^[^ \n][^ \n]*/)||[""])[0],k=k.substr(E.length).replace(/^\n\n*/,"");++q<G;){for(l=a[q]||"";q<G&&m.blanklines.test(l);)k+=l.replace(d,""),l=a[++q]||"";if(!J(h,l)){k=k.replace(/\n\n*$/,"");q--;break}l=l.replace(d,"");if(m.macro_end.test(l)){k+=l.replace(m.macro_end,"");break}k+=l}if(l=this.options.macros[E])l=l.call(t,this,{type:"macro",name:E,text:k}),this.tokens.push(l);continue a}break;case "code":if(s.test(l)){for(k=l.replace(/^    /gm,"");++q<G;){for(l=a[q]||"";q<G&&m.blanklines.test(l);)k+=
l.replace(d,"").replace(/^  {0,3}/gm,""),l=a[++q]||"";l=l.replace(d,"");if(s.test(l))k+=l.replace(/^    /gm,"");else{k=k.replace(/\n\n*$/,"");q--;break}}this.tokens.push({type:"code",text:k,lang:""});continue a}break;case "fences":if(n=s.exec(l)){var E=n[1],v=(n[2]||"").replace(/^  *|  *$/g,""),u=v.match(/^(\**)/)[1].length;k=l.replace(m.fences_start,"").replace(/^\n/,"");if(n=m.fences.exec(l))k=(n[2]||"").substr(1);else for(;++q<G;){for(l=a[q]||"";q<G&&m.blanklines.test(l);)k+=l.replace(d,""),l=
a[++q]||"";if(!J(h,l)){k=k.replace(/\n\n*$/,"");q--;break}l=l.replace(d,"");if((n=m.fences_end.exec(l))&&n[1].length>=E.length){k+=l.replace(m.fences_end,"");break}k+=l}this.tokens.push({type:"code",lang:v.substr(u),text:k,raw:0<u,mix:1<u});continue a}break;case "setext":if(n=s.exec(l)){k=n[1].replace(C,"$1");this.tokens.push({type:"heading",text:k,size:n[2]?1:2});e&&this.tokens.headings.push({size:n[2]?1:2,text:k,index:this.headingIndex++});continue a}break;case "atx":if(n=s.exec(l)){k=n[2].replace(C,
"$1");if(!k||"\n"===k)break;this.tokens.push({type:"heading",text:k,size:n[1].length});e&&this.tokens.headings.push({size:n[1].length,text:k,index:this.headingIndex++});continue a}break;case "blockquote":if(n=s.exec(l)){this.tokens.push({type:"quote_start"});do{k=l.replace(RegExp("^>(?:"+n[1]+")?","gm"),"");this.tokenize(P(k),r?"":0,!1,!1,g);for(l=a[++q]||"";q<G&&m.blanklines.test(l);)l=a[++q]||"";if(!J(h,l)||!(n=s.exec(l=l.replace(d,"")))){q--;break}}while(q<G);this.tokens.push({type:"quote_end"});
continue a}break;case "ul":var x=!0;case "ol":x=x||!1;if(s.test(l)){var w=!0,y=0,u=this.tokens.push({type:x?"ul_start":"ol_start"})-1;c:for(;;){var H;H=x?l.split(/\n(?=[+\-*] )/):l.split(/\n(?=\d\d*\. )/);k=0;for(v=H.length-1;k<v;k++){var z=O(r?H[k].match(/^[^ ]+  */)[0]:p+4),n=RegExp("^[^\\n]+(?:\\n"+z+"[^\\n][^\\n]*)*$");if(!n.test(H[k])){0===y?(w=!1,this.tokens.splice(u)):q--;break c}this.tokens.push({type:"li",text:H[k].replace(/^[^ ]+ +\n?/,"").replace(C,"$1")})}k=H.pop();z=O(r?k.match(/^[^ ]+/)[0]:
p+4);n=RegExp(r?"^[^ ]+( +)[^\\n]*(?:\\n"+z+"\\1[^\\n][^\\n]*)*$":"^[^\\n]+(?:\\n"+z+"[^\\n][^\\n]*)*$");if(!(n=n.exec(k))){0===y?(w=!1,this.tokens.splice(u)):q--;break c}v=this.tokens.push({type:"li_start"});this.tokens.push({type:"text",text:k.replace(/^[^ ]+ +\n?/,"").replace(C,"$1")});this.index=q+1;r?this.tokenize(a,f+z+n[1],e,!0,g):this.tokenize(a,f+1,e,!0,g);this.tokens[u].complex||(1<this.tokens.length-v?this.tokens[u].complex=!0:1===this.tokens.length-v&&"text"!==this.tokens[v].type&&(this.tokens[u].complex=
!0));this.tokens.push({type:"li_end"});q=this.index;for(l=a[q]||"";q<G&&m.blanklines.test(l);)l=a[++q]||"";if(!J(h,l)||!s.test(l=l.replace(d,""))){q--;break}y++}if(w){x?this.tokens.push({type:"ul_end"}):this.tokens.push({type:"ol_end"});x=null;continue a}}x=null;break;case "dl":if(n=s.exec(l)){w=!0;y=0;u=this.tokens.push({type:"dl_start"})-1;c:do{z=n[1].replace(C,"$1").split("\n");k=0;for(v=z.length;k<v;k++)this.tokens.push({type:"dt",text:z[k]});for(;;){z=(n&&n[2]||l).split(/\n(?=: )/);n=r?m.dd:
m.dd_pedantic;k=0;for(v=z.length-1;k<v;k++){if(!n.test(z[k])){0===y?(w=!1,this.tokens.splice(u)):q--;break c}this.tokens.push({type:"dd",text:z[k].replace(/^: +\n?/,"").replace(C,"$1")})}v=this.tokens.push({type:"dd_start"});k=z.pop();if(!(n=n.exec(k))){0===y?(w=!1,this.tokens.splice(u)):q--;break c}this.tokens.push({type:"text",text:k.replace(/^: +\n?/,"").replace(C,"$1")});this.index=q+1;r?this.tokenize(a,f+" "+n[1],e,!0,g):this.tokenize(a,f+1,e,!0,g);this.tokens[u].complex||(1<this.tokens.length-
v?this.tokens[u].complex=!0:1===this.tokens.length-v&&"text"!==this.tokens[v].type&&(this.tokens[u].complex=!0));this.tokens.push({type:"dd_end"});q=this.index;for(l=a[q]||"";q<G&&m.blanklines.test(l);)l=a[++q]||"";if(!J(h,l)||!m.dd.test(l=l.replace(d,"")))break;n=null}for(l=a[q]||"";q<G&&m.blanklines.test(l);)l=a[++q]||"";if(!J(h,l)||!(n=s.exec(l=l.replace(d,"")))){q--;break}y++}while(1);if(w){this.tokens.push({type:"dl_end"});continue a}}break;case "links":if(s.test(l)){w=l.split(/\n(?=:)/);u={};
k=0;for(v=w.length;k<v;k++)if(n=m.link.exec(w[k]))s=n[1].toLowerCase(),u[s]={href:n[2],title:(n[3]||"").replace(/\\(["\\])/g,"$1")};else break b;I(this.tokens.links,u);continue a}break;case "images":if(s.test(l)){w=null;y=l.split(/\n(?=@)/);u={};k=0;for(v=y.length;k<v;k++)if(n=m.image.exec(y[k]))s=n[1].toLowerCase(),w=(n[3]||"").split(","),u[s]={href:n[2],title:(n[5]||"").replace(/\\(["\\])/g,"$1"),width:w[0]||"",height:w[1]||"",align:(n[4]||"").substr(1)};else break b;I(this.tokens.images,u);continue a}break;
case "figures":if(s.test(l)){s=l.split(/\n(?=\[)/);u=this.tokens.length;k=0;for(v=s.length;k<v;k++)if(n=m.figure.exec(s[k]))w=(n[3]||"").split(","),this.tokens.push({type:"figure",text:n[1].replace(C,"$1"),href:n[2],title:(n[5]||"").replace(/\\(["\\])/g,"$1"),width:w[0]||"",height:w[1]||"",align:(n[4]||"").substr(1)});else{this.tokens.splice(u);break b}continue a}break;case "footnotex":if(!g&&(n=s.exec(l))){s=n[1].toLowerCase();this.tokens.notes[s]={index:this.noteIndex,text:"",escaped:!0,refs:[]};
this.tokens.push({type:"note_start",name:s,index:this.noteIndex++});a[q]=n[2].substr(1);this.index=q;r?this.tokenize(a,f+"    ",e,!0,!0):this.tokenize(a,f+1,e,!0,!0);q=this.index-1;this.tokens.push({type:"note_end"});continue a}break;case "footnotes":if(!g&&s.test(l)){w=l.split(/\n(?=\^)/);u={};k=0;for(v=w.length;k<v;k++)if(n=m.footnote.exec(w[k]))s=n[1].toLowerCase(),u[s]={index:this.noteIndex++,text:n[2].replace(C,"$1"),escaped:!1,refs:[]};else break b;I(this.tokens.notes,u);continue a}break;case "abbrs":if(s.test(l)){w=
l.split(/\n(?=\*)/);u={};k=0;for(v=w.length;k<v;k++)if(n=m.abbr.exec(w[k]))s=n[1],u[s]=n[2].replace(C,"$1");else break b;I(this.tokens.abbrs,u);continue a}break;case "hr":if(s.test(l)){this.tokens.push({type:"hr"});continue a}break;case "table":if(s.test(l)){u=this.tokens.push({type:"table_start"})-1;s=l.split("\n");z=y=w=!1;H=null;k=0;for(v=s.length-1;k<=v;k++)if(n=m.table_line.exec(s[k])){if(0!==k&&k!==v&&("|"!==n[1]||"|"!==n[3])){this.tokens.splice(u);break b}if(0===k)n[2]?(w=!0,this.tokens.push({type:"thead_start"})):
(y=!0,this.tokens.push({type:"tbody_start"}));else if(w)if(n[2])w=!1,this.tokens.push({type:"thead_end"}),y=!0,this.tokens.push({type:"tbody_start"});else{this.tokens.splice(u);break b}else if(!z&&n[2])y&&(y=!1,this.tokens.push({type:"tbody_end"})),z=!0,this.tokens.push({type:"tfoot_start"});else if(z)if(k<v||n[2]){this.tokens.splice(u);break b}else this.tokens.push({type:"tfoot_end"});else y?(y=!1,this.tokens.push({type:"tbody_end"})):(y=!0,this.tokens.push({type:"tbody_start"}))}else{y||w||z||(y=
!0,this.tokens.push({type:"tbody_start"}));n=s[k].replace(/[^ ] *$/g,"");if("\\"===n.charAt(n.length-1)){this.tokens.splice(u);break b}n=R(n);this.tokens.push({type:"tr_start"});H=H||Array(n.cellLength);for(var B=Array(n.cellLength),A=null,F=null,N=0,K=0,M=n.length-1;K<=M;K++){if(/^[\^|]?$/.test(n[K+1]||""))A&&this.tokens[A].colspan++;else if(K<M){var L=n[K+1];/^ *::: *$/.test(L)?(F=this.tokens[H[N]])?(F.rowspan++,B[N]=H[N]):(A=this.tokens.push({type:"|"===n[K]?"td":"th",text:L.replace(C,"$1"),align:/^  /.test(L)?
/  $/.test(L)?"center":"right":"left",colspan:1,rowspan:1})-1,B[N]=A):(A=this.tokens.push({type:"|"===n[K]?"td":"th",text:L.replace(C,"$1").replace(/\\([\^|])/g,"$1"),align:/^  /.test(L)?/  $/.test(L)?"center":"right":"left",colspan:1,rowspan:1})-1,B[N]=A);K++}N++}this.tokens.push({type:"tr_end"});H=B}this.tokens.push({type:"table_end"});continue a}break;case "paragraph":this.tokens.push({type:"p",text:l.replace(C,"$1")});continue a;default:throw Error('Rule "'+k+'" does not have a handler.');}}throw Error("Infinite loop on block"+
q+": <["+l+"]>");}this.index=b?q:D;return this.tokens};var S;S={escape:[0,/^\\([\s\S]?)/],verbatim:[1,/^(``*)((?:\\`|[\s\S])+?)(\1`*)(?:\((?! )((?:\\[\s\S]|[^\\])+?)( *)\))?/],strong:[2,/^(\*\*\**)(?! )((?:\\[\s\S]|[^\\])+?)( *)(\*\*\**)/],em:[3,/^(___*)(?! )((?:\\[\s\S]|[^\\])+?)( *)(___*)/],del:[4,/^(~~~*)(?! )((?:\\[\s\S]|[^\\])+?)( *)(~~~*)/],ref:[5,/^\|(?! )((?:\\[\s\S]|[^\\])+?)( *)\|/],anchor:[6,/^\{(?! )((?:\\[\s\S]|[^\\])+?)( *)\}/],autolink:[7,/^\[\[(?! )((?:\\[\s\S]|[^\\])+?)( *)\]\]/],
image:[8,/^\[(?! )((?:\\[\s\S]|[^\\])*?)( *)\]@(?:\[(?! )((?:\\[\s\S]|[^\\])*?)( *)\]|\((?! )((?:\\[\s\S]|[^\\])*?)( *)\))/],link:[9,/^\[(?! )((?:\\[\s\S]|[^\\])+?)( *)\](?::\[(?! )((?:\\[\s\S]|[^\\])*?)( *)\]|:\((?! )((?:\\[\s\S]|[^\\])*?)( *)\))?/],footnote:[10,/^\^\[(?! )((?:\\[\s\S]|[^\\])+?)( *)\]/],comment:[11,/^\x3c!--[\s\S]*?--\x3e/],tag:[12,/^<\/?\w+(?:"[^"]*"|'[^']'| *[^"'>])*>/]};var B=function(a,f){this.options=I({},t.defaults,f||{});this.options.generalPrefix=p(this.options.generalPrefix);
this.options.languagePrefix=p(this.options.languagePrefix);this.rules=S;this.options.sanitize&&(delete this.rules.tag,delete this.rules.comment);this.links=a.links||{};this.images=a.images||{};this.abbrs=a.abbrs||{};this.notes=a.notes||{};this.headings=a.headings||[];var e=[],b;for(b in this.rules)e.push([this.rules[b][0],b]);e.sort(function(a,b){return a[0]<b[0]?-1:1});b=0;for(var g=e.length;b<g;b++)e[b]=e[b][1];this.ruleNames=e;this.refIndex=0};B.translate=function(a,f,e,b){return(new B(f,e)).translate(a,
!b)};B.prototype.translate=function(a,f,e){var b=this.options,g="",c="";a:for(;a;){for(var r=0,m;m=this.ruleNames[r];r++){var h=this.rules[m][1],d=null;switch(m){case "escape":if(d=h.exec(a)){a=a.substr(2);if(e){d[1]||(d[0]+="\n");c+=d[0].replace(x,"$1");continue a}c=" "===d[1]?c+"&nbsp;":"\n"!==d[1]&&d[1]?c+p(d[0].replace(M,"$1")):c+"\\\n";continue a}break;case "strong":case "em":case "del":if(d=h.exec(a)){if(d[3]||2<d[1].length||d[1].length!==d[4].length)break;a=a.substr(d[0].length);if(e){c=this.wrap(c,
null,!0);c+=this.translate(d[2],null,!0);g+=c;c="";continue a}c=this.wrap(this.abbr(p(c,!0)),f);c="strong"===m?c+("<b>"+this.translate(d[2])+"</b>"):"em"===m?c+("<i>"+this.translate(d[2])+"</i>"):c+("<del>"+this.translate(d[2])+"</del>");g+=c;c="";continue a}break;case "verbatim":if(d=h.exec(a)){h=!0;d[4]=d[4]||"";d[5]=d[5]||"";!d[2]||"`"===d[2]||1<d[1].length&&(2>d[3].length||d[5])?h=!1:1===d[1].length&&(1===d[3].length&&/^(?:\\[`\\]|[^`\\])+$/.test(d[2])||(h=!1));if(!h)break;a=1!==d[1].length?a.substr(d[0].length):
a.substr(d[1].length+d[2].length+d[3].length);if(e){c=this.wrap(c,null,!0);c=1===d[1].length?c+this.wrap(d[2].replace(/\\([\\`])/g,"$1"),null,!0):c+this.wrap(d[2],null,!0);g+=c;c="";continue a}c=this.wrap(this.abbr(p(c,!0)),f);1===d[1].length?(r=d[2].replace(/\\([\\`])/g,"$1"),c+='<span class="'+b.generalPrefix+'literal">'+this.wrap(this.abbr(p(r)))+"</span>"):(h="",d[4]&&(h=d[4].replace(x,"$1"),b.sanitize&&(h=h.replace(/  */g,"-")),h=' class="'+b.languagePrefix+p(h)+'"'),r=d[2]+d[3].slice(0,0-d[1].length),
c+="<code"+h+">"+this.wrap(this.abbr(p(r)))+"</code>");g+=c;c="";continue a}break;case "link":if(d=h.exec(a)){if(d[2]||d[4]||d[6])break;a=a.substr(d[0].length);if(e){c=this.wrap(c,null,!0);c+=this.translate(d[1],null,!0);g+=c;c="";continue a}c=this.wrap(this.abbr(p(c,!0)),f);r=d[1];h=(d[3]||"").replace(x,"$1");d=(d[5]||"").replace(x,"$1");m="";if(d)d=p(this.shapeUri(this.wrap(d,null,!0)));else switch(h=this.wrap(h,null,!0),h.charAt(0)){case "^":h=h.substr(1).toLowerCase();this.notes[h]&&(d="#"+b.generalPrefix+
"footnote-"+this.notes[h].index);break;case "@":h=h.substr(1).toLowerCase();this.images[h]&&(d=p(this.shapeUri(this.images[h].href)),m=p(this.images[h].title));break;case "*":h=h.substr(1).toLowerCase();d="#"+b.generalPrefix+"anchor-"+p(h);m=p(h);break;default:h=(h||this.translate(r,null,!0)).toLowerCase(),this.links[h]&&(d=p(this.shapeUri(this.links[h].href)),m=p(this.links[h].title))}c+='<a class="'+b.generalPrefix+'ref-link"'+(d?' href="'+d+'"':"")+(m?' title="'+m+'"':"")+">"+this.translate(r)+
"</a>";g+=c;c="";continue a}break;case "autolink":if(d=h.exec(a)){if(d[2])break;if(e){c=this.wrap(c,null,!0);r=this.wrap(d[1].replace(x,"$1"),null,!0);c=/^[@:^]/.test(r)?c+r.substr(1):c+r;g+=c;c="";continue a}a=a.substr(d[0].length);c=this.wrap(this.abbr(p(c,!0)),f);h=this.wrap(d[1].replace(x,"$1"),null,!0);r=m=d="";switch(h.charAt(0)){case "@":r="raw";h=h.substr(1).toLowerCase();this.images[h]&&(d=p(this.shapeUri(this.images[h].href,!0)),m=p(this.images[h].title),h=d);break;case ":":r="raw";h=h.substr(1).toLowerCase();
this.links[h]&&(d=p(this.shapeUri(this.links[h].href,!0)),m=p(this.links[h].title),h=d);break;case "^":r="ref";h=h.substr(1);this.notes[h.toLowerCase()]&&(d="#"+b.generalPrefix+"footnote-"+this.notes[h.toLowerCase()].index,h=p(h));break;default:!/^[^ \n][^ \n]*@[^ \/\n][^ \/\n]*$/.test(h)||/^[A-Za-z][+\-.0-9A-Za-z]*:/.test(h)?(r="raw",h=d=p(this.shapeUri(h,!0))):(r="mail",h=h.replace(/./g,function(a){return"&#"+a.charCodeAt(0)+";"}),d="mailto:"+h)}c+='<a class="'+b.generalPrefix+r+'-link"'+(d?' href="'+
d+'"':"")+(m?' title="'+m+'"':"")+">"+h+"</a>";g+=c;c="";continue a}break;case "footnote":if(d=h.exec(a)){if(d[2])break;a=a.substr(d[0].length);if(e){c=this.wrap(c,null,!0);g+=c;c="";continue a}c=this.wrap(this.abbr(p(c,!0)),f);h=this.wrap(d[1].replace(x,"$1"),null,!0);r=0;this.notes[h]&&(r=this.notes[h].index,this.notes[h].refs.push(++this.refIndex));c+="<a"+(r?' id="'+b.generalPrefix+"ref-footnote-"+this.refIndex+'"':"")+' class="'+b.generalPrefix+'ref-footnote"'+(r?' href="#'+b.generalPrefix+"footnote-"+
r+'"':"")+"><sup>"+r+"</sup></a>";g+=c;c="";continue a}break;case "image":if(d=h.exec(a)){if(d[2]||d[4]||d[6])break;a=a.substr(d[0].length);if(e){c=this.wrap(c,null,!0);c+=this.wrap(d[1].replace(x,"$1"),null,!0);g+=c;c="";continue a}var c=this.wrap(this.abbr(p(c,!0)),f),r=this.wrap(d[1].replace(x,"$1"),null,!0),h=(d[3]||"").replace(x,"$1"),d=(d[5]||"").replace(x,"$1"),D=m="",q="",t="";d?d=p(this.shapeUri(this.wrap(d,null,!0))):(h=this.wrap(h,null,!0).toLowerCase(),this.images[h]&&(d=this.shapeUri(this.images[h].href),
m=this.images[h].title,D=this.filterCss(this.images[h].width),q=this.filterCss(this.images[h].height),t=this.images[h].align));h="";b.stylish&&(D||q)&&(h=' style="'+(t?"float:"+p(t)+";":"")+(D?"width:"+p(D)+";":"")+(q?"height:"+p(q)+";":"")+'"');c+='<img src="'+p(d)+'"'+(r?' alt="'+p(r)+'"':"")+(m?' title="'+p(m)+'"':"")+(!b.stylish&&t?' align="'+t+'"':"")+(b.stylish?h:(D?' width="'+p(D)+'"':"")+(q?' height="'+p(q)+'"':""))+(b.xhtml?"/>":">");g+=c;c="";continue a}break;case "anchor":case "ref":if(d=
h.exec(a)){if(d[2])break;a=a.substr(d[0].length);if(e){c=this.wrap(c,null,!0);c+=this.translate(d[1],null,!0);g+=c;c="";continue a}c=this.wrap(this.abbr(p(c,!0)),f);r=d[1];h=this.translate(r,null,!0).replace(/  */g,"-").toLowerCase();c="anchor"===m?c+('<a class="'+b.generalPrefix+'anchor" id="'+b.generalPrefix+"anchor-"+p(h)+'"></a>'+this.translate(r)):c+('<a class="'+b.generalPrefix+'ref-anchor" href="#'+b.generalPrefix+"anchor-"+p(h)+'">'+this.translate(r)+"</a>");g+=c;c="";continue a}break;case "comment":case "tag":if(d=
h.exec(a)){a=a.substr(d[0].length);if(e)continue a;c=this.wrap(this.abbr(p(c,!0)),f);g+=c+d[0];c="";continue a}break;default:throw Error('Format "'+m+'" does not have a handler.');}}c+=a.charAt(0);a=a.substr(1)}c&&(g=e?g+this.wrap(c,null,!0):g+this.wrap(this.abbr(p(c,!0)),f));return g};B.prototype.wrap=function(a,f,e){if(this.nowrap)return a;var b=this.options;switch(b.wrappingMode){case "default":a=e?a.replace(/\\\n/g,"\r").replace(/\n/g," ").replace(/\r/g,"\n"):a.replace(/\\\n/g,b.xhtml?"<br/>":
"<br>").replace(/\n/g," ");break;case "break":e||(a=a.split("\n").join(b.xhtml?"<br/>\n":"<br>\n"));break;case "paragraph":e||(a=f?a.split("\n").join("</p>\n<p>"):a.split("\n").join(b.xhtml?"<br/>\n":"<br>\n"));break;case "ignore":a=e?a.replace(/\\(\n)|\n/g,"$1"):a.replace(/\\\n/g,b.xhtml?"<br/>":"<br>").replace(/\n/g,"");break;default:throw Error('Invalid wrapping mode: "'+b.wrappingMode+'"');}return a};B.prototype.abbr=function(a){var f=[],e={},b;for(b in this.abbrs){var g=p(b,!0);e[g]=this.abbrs[b];
f.push(Q(g))}if(!f.length)return a;var f=RegExp(f.join("|"),"g"),c=this;return a.replace(f,function(a){return'<abbr title="'+c.wrap(p(e[a]),null,!0)+'">'+a+"</abbr>"})};B.prototype.shapeUri=function(a,f){var e=this.options.baseUri;if(!f||!e)return this.filterUri(a);/^[A-Za-z][+\-.0-9A-Za-z]*:/.test(a)||(a="//"===a.substr(0,2)?(e.match(/^[^:]+:/)||[""])[0]+a:"?"===a.charAt(0)||"#"===a.charAt(0)?e+a:"/"===a.charAt(0)?(e.match(/^[^:]+:\/\/[^\/]+/)||[""])[0]+a:e.replace(/^([^:]+:\/\/[\s\S]+)\/[^\/]*$/,
"$1")+"/"+a);return this.filterUri(a)};B.prototype.filterUri=function(a){return this.options.sanitize?a.replace(/( )|\s/g,"$1").replace(/^\s*javascript\s*:/i,"XSS"):a};B.prototype.filterCss=function(a){return this.options.sanitize?a.replace(/\s/g,"").replace(/expression/i,"XSS"):a};var A=function(a){this.options=I({},t.defaults,a||{});this.options.generalPrefix=p(this.options.generalPrefix);this.options.languagePrefix=p(this.options.languagePrefix);this.token=null;this.headingIndex=1};A.parse=function(a,
f){return(new A(f)).parse(a)};A.prototype.parse=function(a){this.inlineLexer=new B({links:a.links,images:a.images,abbrs:a.abbrs,notes:a.notes,headings:a.headings},this.options);a.reverse();this.tokens=a;for(a="";this.next();)a+=this.translate(!0);a+=this.generateFootnote(this.tokens.notes);return"\n"===a.charAt(0)?a.substr(1):a};A.prototype.next=function(){return this.token=this.tokens.pop()};A.prototype.translate=function(a){var f=this.options,e=this.token,b=e.text||"";switch(e.type){case "p":b=
"\n<p>"+this.inlineLexer.translate(b,!0)+"</p>";break;case "code":a=e.escaped;var g=e.lang;f.sanitize&&e.raw&&!f.highlight&&(e.raw=e.mix=!1);if(f.highlight&&!e.mix&&!a){var c=f.highlight(b,g,e.raw);c&&(a=!0,b=c)}e.raw?e.mix&&(this.inlineLexer.nowrap=!0,b=this.inlineLexer.translate(b),this.inlineLexer.nowrap=!1):b=g?'<pre class="'+f.languagePrefix+p(f.sanitize?g.replace(/  */g,"-"):g)+'">'+(a?b:p(b))+"</pre>":"<pre>"+(a?b:p(b))+"</pre>";b="\n"+b;break;case "heading":b=this.inlineLexer.translate(b);
a=a?' id="'+f.generalPrefix+"heading-"+this.headingIndex++ +'"':"";g=e.size+f.headingBase-1;b=6>=g?"\n<h"+g+a+">"+b+"</h"+g+">":"\n<p"+a+' class="'+f.generalPrefix+"heading-"+e.size+'">'+b+"</p>";break;case "figure":a="";var g=this.inlineLexer.filterCss(e.width),c=this.inlineLexer.filterCss(e.height),m=e.align;f.stylish&&(g||c||m)&&(a=' style="'+(m?"float:"+p(m)+";":"")+(g?"width:"+p(g)+";":"")+(c?"height:"+p(c)+";":"")+'"');b=this.inlineLexer.wrap(b.replace(M,"$1"),null,!0);b='\n<img src="'+p(e.href)+
'"'+(b?' alt="'+p(b)+'"':"")+(e.title?' title="'+p(e.title)+'"':"")+(!f.stylish&&m?' align="'+m+'"':"")+(f.stylish?a:(g?' width="'+p(g)+'"':"")+(c?' height="'+p(c)+'"':""))+(f.xhtml?"/>":">");break;case "quote_start":for(b="\n<blockquote>";"quote_end"!==this.next().type;)b+=this.translate();b+="\n</blockquote>";break;case "li":b=this.inlineLexer.translate(b,e.complexMode);b="\n<li>"+(e.complexMode?"\n<p>"+b+"</p>\n</li>":b+"</li>");break;case "li_start":b="\n<li>";for(f=b.length;"li_end"!==this.next().type;)this.token.complexMode=
e.complexMode,b+=this.translate();b="\n"===b.charAt(f)?b+"\n</li>":b+"</li>";break;case "ul_start":for(b="\n<ul>";"ul_end"!==this.next().type;)this.token.complexMode=e.complex,b+=this.translate();b+="\n</ul>";break;case "ol_start":for(b="\n<ol>";"ol_end"!==this.next().type;)this.token.complexMode=e.complex,b+=this.translate();b+="\n</ol>";break;case "text":(b=this.inlineLexer.translate(b,e.complexMode))&&e.complexMode&&(b="\n<p>"+b+"</p>");break;case "note_start":b="";if(this.tokens.notes[e.name].index===
e.index){for(;"note_end"!==this.next().type;)b+=this.translate();this.tokens.notes[e.name].text=b;b=""}break;case "td":case "th":b=this.inlineLexer.translate(b);b="\n<"+e.type+(1<e.colspan?' colspan="'+e.colspan+'"':"")+(1<e.rowspan?' rowspan="'+e.rowspan+'"':"")+(f.stylish?' style="text-align:'+e.align+';"':' align="'+e.align+'"')+">"+b+"</"+e.type+">";break;case "tr_start":for(b="\n<tr>";"tr_end"!==this.next().type;)b+=this.translate();b+="\n</tr>";break;case "tbody_start":for(b="\n<tbody>";"tbody_end"!==
this.next().type;)b+=this.translate();b+="\n</tbody>";break;case "table_start":for(b="\n<table>";"table_end"!==this.next().type;)b+=this.translate();b+="\n</table>";break;case "thead_start":for(b="\n<thead>";"thead_end"!==this.next().type;)b+=this.translate();b+="\n</thead>";break;case "tfoot_start":for(b="\n<tfoot>";"tfoot_end"!==this.next().type;)b+=this.translate();b+="\n</tfoot>";break;case "hr":b="\n<hr"+(f.xhtml?"/>":">");break;case "dt":b=this.inlineLexer.translate(b);b="\n<dt>"+b+"</dt>";
break;case "dd":b=this.inlineLexer.translate(b,e.complexMode);b="\n<dd>"+(e.complexMode?"\n<p>"+b+"</p>\n</dd>":b+"</dd>");break;case "dd_start":b="\n<dd>";for(f=b.length;"dd_end"!==this.next().type;)this.token.complexMode=e.complexMode,b+=this.translate();b="\n"===b.charAt(f)?b+"\n</dd>":b+"</dd>";break;case "dl_start":for(b="\n<dl>";"dl_end"!==this.next().type;)this.token.complexMode=e.complex,b+=this.translate();b+="\n</dl>";break;case "macro":b=(b=this.options.macros[this.token.name])?b.call(t,
this,e):"";break;default:throw Error('Token "'+this.token.type+'" does not have a renderer.');}return b};A.prototype.generateContents=function(a,f){for(var e=this.options,b=this.inlineLexer,g='\n<div id="'+e.generalPrefix+'contents">'+(f?'\n<div class="'+e.generalPrefix+'contents-title">'+b.translate(f)+"</div>":""),c=0,m=0,t;t=a[m];m++){var h=t.size;if(h>c)for(var d=0,D=h-c;d<D;d++)g=d||c?g+"\n<li><ul>":g+"\n<ul>";else if(h<c)for(d=0,D=c-h;d<D;d++)g+="\n</ul></li>";g+='\n<li><a href="#'+e.generalPrefix+
"heading-"+t.index+'">'+p(b.translate(t.text,null,!0),!0)+"</a></li>";c=h}d=0;for(D=c-1;d<=D;d++)g=d<D?g+"\n</ul></li>":g+"\n</ul>";return(g+"\n</div>").replace(/<\/li>\n<li><ul>/g,"\n<ul>").replace(/<\/ul><\/li>/g,"</ul>\n</li>")};A.prototype.generateFootnote=function(a){var f=[],e;for(e in a)f.push(a[e]);if(1>f.length)return"";f.sort(function(a,b){return a.index<b.index?-1:1});a=this.options;e='\n<div id="'+a.generalPrefix+'footnotes">\n<hr'+(a.xhtml?"/>":">")+"\n<table>\n<tbody"+(a.stylish?' style="vertical-align:top;"':
' valign="top"')+">";for(var b=0,g;g=f[b];b++){var c="\n<tr"+(' class="'+a.generalPrefix+'footnote" id="'+a.generalPrefix+"footnote-"+g.index+'"')+">\n<td>["+g.index+"]</td>\n<td>"+(g.escaped?g.text:this.inlineLexer.translate(g.text));switch(g.refs.length){case 0:break;case 1:c+=(g.escaped?"\n<p><em>":" <em>")+'<a class="'+a.generalPrefix+'footnote-backref" href="#'+a.generalPrefix+"ref-footnote-"+g.refs[0]+'">&#8617;</a>'+(g.escaped?"</em></p>":"</em>");break;default:for(var c=c+((g.escaped?"\n<p><em>":
" <em>")+"&#8617;("),m=0,p=g.refs.length-1;m<=p;m++)c+='<a class="'+a.generalPrefix+'footnote-backref" href="#'+a.generalPrefix+"ref-footnote-"+g.refs[m]+'">'+g.refs[m]+"</a>"+(m<p?", ":"");c+=g.escaped?")</em></p>":")</em>"}e+=c+(g.escaped?"\n":"")+"</td>\n</tr>"}return e+"\n</tbody>\n</table>\n</div>"};var t=function(a,f,e){"function"===typeof f&&(e=f,f=null);f&&(f=I({},t.defaults,f));if(e){var b=f.highlight,g=null;try{g=F.lex(a,f)}catch(c){return e(c)}var m=function(){var a,c;try{a=A.parse(g,f)}catch(d){c=
d}f.highlight=b;return c?e(c):e(null,a)};if(!b||4>b.length)return m();delete f.highlight;var x=g.length;if(!x)return m();a=0;for(var h=g.length;a<h;a++)(function(a){if("code"!==a.type||a.mix||a.escaped)return--x||m();b(a.text,a.lang,a.raw,function(b,c){if(b){if((f||t.defaults).silent)return a.text="<p>An error occured:</p><pre>"+p(b.message+"")+"</pre>",a.escaped=!0,--x||m();throw b;}if(!c||c===a.text)return--x||m();a.text=c;a.escaped=!0;--x||m()})})(g[a])}else try{return A.parse(F.lex(a,f),f)}catch(d){d.message+=
"\nPlease report this to https://github.com/jakwings/strictdown/issues";if((f||t.defaults).silent)return"<p>An error occured:</p><pre>"+p(d.message+"")+"</pre>";throw d;}};t.setOptions=function(a){I(t.defaults,a);return t};t.setMacros=function(a){I(t.defaults.macros,a);return t};t.defaults={silent:!1,sanitize:!1,pedantic:!1,hardtab:!1,xhtml:!1,wrappingMode:"default",headingBase:1,generalPrefix:"smd-",languagePrefix:"lang-",baseUri:"",stylish:!0,highlight:null,macros:{toc:function(a,f){if(a instanceof
this.BlockLexer)return f.text=f.text.replace(C,"$1"),f;if(a instanceof this.Parser)return a.generateContents(a.tokens.headings,f.text)}}};t.helpers={escape:p,quotemeta:Q,pad:O,split:P,merge:I,reTrim:C,reEscape:M,reEscape2:x,isIndented:J,splitTableRow:R};t.BlockLexer=F;t.BlockLex=F.lex;t.InlineLexer=B;t.InlineLex=B.translate;t.Parser=A;t.tokenize=F.lex;t.parse=A.parse;"object"===typeof exports?module.exports=t:"function"===typeof define&&define.amd?define("strictdown",function(){return t}):T.strictdown=
t})(this);
